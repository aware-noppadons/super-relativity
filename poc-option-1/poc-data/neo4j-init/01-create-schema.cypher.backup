// Super Relativity - Neo4j Schema Initialization
// Creates constraints, indexes, and sample data

// ============================================================================
// CONSTRAINTS - Ensure data integrity
// ============================================================================

// (Requirements removed - not needed in simplified schema)

// Applications
CREATE CONSTRAINT application_id IF NOT EXISTS
FOR (a:Application) REQUIRE a.id IS UNIQUE;

// Data Objects
CREATE CONSTRAINT data_object_id IF NOT EXISTS
FOR (d:DataObject) REQUIRE d.id IS UNIQUE;

// Business Capabilities
CREATE CONSTRAINT capability_id IF NOT EXISTS
FOR (c:BusinessFunction) REQUIRE c.id IS UNIQUE;

// Components
CREATE CONSTRAINT component_id IF NOT EXISTS
FOR (c:Component) REQUIRE c.id IS UNIQUE;

// Containers (C4 Model - will be migrated to API)
CREATE CONSTRAINT container_id IF NOT EXISTS
FOR (c:Container) REQUIRE c.id IS UNIQUE;

// APIs (created from Container migration)
CREATE CONSTRAINT api_id IF NOT EXISTS
FOR (a:API) REQUIRE a.id IS UNIQUE;

// Tables (Physical storage)
CREATE CONSTRAINT table_id IF NOT EXISTS
FOR (t:Table) REQUIRE t.id IS UNIQUE;

// Servers
CREATE CONSTRAINT server_id IF NOT EXISTS
FOR (s:Server) REQUIRE s.id IS UNIQUE;

// Application Changes
CREATE CONSTRAINT app_change_id IF NOT EXISTS
FOR (ac:AppChange) REQUIRE ac.id IS UNIQUE;

// Infrastructure Changes
CREATE CONSTRAINT infra_change_id IF NOT EXISTS
FOR (ic:InfraChange) REQUIRE ic.id IS UNIQUE;

// ============================================================================
// INDEXES - Improve query performance
// ============================================================================

// Text search indexes
// (Requirement indexes removed)

CREATE INDEX application_name IF NOT EXISTS
FOR (a:Application) ON (a.name);

CREATE INDEX data_object_name IF NOT EXISTS
FOR (d:DataObject) ON (d.name);

// Property indexes for filtering
CREATE INDEX application_lifecycle IF NOT EXISTS
FOR (a:Application) ON (a.lifecycle);


CREATE INDEX data_object_sensitivity IF NOT EXISTS
FOR (d:DataObject) ON (d.sensitivity);

CREATE INDEX capability_criticality IF NOT EXISTS
FOR (c:BusinessFunction) ON (c.criticality);

CREATE INDEX capability_level IF NOT EXISTS
FOR (c:BusinessFunction) ON (c.level);

// ============================================================================
// TIER 1 CRITICAL INDEXES - High-frequency properties (40+ queries)
// ============================================================================

// Name indexes for missing node types
CREATE INDEX component_name IF NOT EXISTS
FOR (c:Component) ON (c.name);

CREATE INDEX container_name IF NOT EXISTS
FOR (c:Container) ON (c.name);

CREATE INDEX api_name IF NOT EXISTS
FOR (a:API) ON (a.name);

CREATE INDEX table_name IF NOT EXISTS
FOR (t:Table) ON (t.name);

CREATE INDEX server_name IF NOT EXISTS
FOR (s:Server) ON (s.name);

CREATE INDEX app_change_name IF NOT EXISTS
FOR (ac:AppChange) ON (ac.name);

CREATE INDEX infra_change_name IF NOT EXISTS
FOR (ic:InfraChange) ON (ic.name);

CREATE INDEX business_capability_name IF NOT EXISTS
FOR (bc:BusinessFunction) ON (bc.name);

// Compliance & Security (15+ queries)
// (Requirement compliance index removed)

// Environment & Deployment (20+ queries)
CREATE INDEX server_environment IF NOT EXISTS
FOR (s:Server) ON (s.environment);

// ============================================================================
// TIER 2 IMPORTANT INDEXES - Moderate-frequency properties (10+ queries)
// ============================================================================

// Change Management
CREATE INDEX app_change_status IF NOT EXISTS
FOR (ac:AppChange) ON (ac.status);

CREATE INDEX app_change_priority IF NOT EXISTS
FOR (ac:AppChange) ON (ac.priority);

CREATE INDEX infra_change_status IF NOT EXISTS
FOR (ic:InfraChange) ON (ic.status);

CREATE INDEX infra_change_priority IF NOT EXISTS
FOR (ic:InfraChange) ON (ic.priority);


// Relationship property indexes for MODIFY action filtering
CREATE INDEX modify_action IF NOT EXISTS
FOR ()-[r:MODIFY]-() ON (r.action);

// Technology & Type
CREATE INDEX component_technology IF NOT EXISTS
FOR (c:Component) ON (c.technology);

CREATE INDEX component_type IF NOT EXISTS
FOR (c:Component) ON (c.type);

CREATE INDEX container_technology IF NOT EXISTS
FOR (c:Container) ON (c.technology);

CREATE INDEX container_type IF NOT EXISTS
FOR (c:Container) ON (c.type);

CREATE INDEX api_technology IF NOT EXISTS
FOR (a:API) ON (a.technology);

CREATE INDEX api_type IF NOT EXISTS
FOR (a:API) ON (a.type);

CREATE INDEX application_type IF NOT EXISTS
FOR (a:Application) ON (a.type);

CREATE INDEX data_object_type IF NOT EXISTS
FOR (d:DataObject) ON (d.type);

CREATE INDEX table_database IF NOT EXISTS
FOR (t:Table) ON (t.database);

CREATE INDEX table_schema IF NOT EXISTS
FOR (t:Table) ON (t.schema);

// Business Value
CREATE INDEX application_business_value IF NOT EXISTS
FOR (a:Application) ON (a.businessValue);

CREATE INDEX business_capability_maturity IF NOT EXISTS
FOR (bc:BusinessFunction) ON (bc.maturity);

// ============================================================================
// COMPOSITE INDEXES - Common filter combinations
// ============================================================================

// Application filtering
CREATE INDEX application_lifecycle_value IF NOT EXISTS
FOR (a:Application) ON (a.lifecycle, a.businessValue);

// Compliance scoping
CREATE INDEX data_object_sensitivity_app IF NOT EXISTS
FOR (d:DataObject) ON (d.sensitivity, d.application);

// Change management
CREATE INDEX app_change_status_priority IF NOT EXISTS
FOR (ac:AppChange) ON (ac.status, ac.priority);

CREATE INDEX infra_change_status_priority IF NOT EXISTS
FOR (ic:InfraChange) ON (ic.status, ic.priority);

// Server deployment
CREATE INDEX server_env_purpose IF NOT EXISTS
FOR (s:Server) ON (s.environment, s.purpose);

// Full-text search indexes (all entity types)
// NOTE: Commented out - procedure name changed in Neo4j 5.x
// CALL db.index.fulltext.createNodeIndex(
//   'searchAllEntities',
//   [
//     'Application', 'DataObject', 'BusinessFunction',
//     'Component', 'Server', 'AppChange', 'InfraChange', 'API', 'Table'
//   ],
//   ['name', 'description']
// );

// ============================================================================
// SAMPLE DATA - Initial dataset for POC
// ============================================================================

// (Sample Requirements removed - not needed in simplified schema)

// Sample Applications
CREATE (a1:Application {
  id: 'APP-123',
  name: 'Customer Portal',
  type: 'Web Application',
  businessValue: 'High',
  technicalFit: 'Good',
  lifecycle: 'Active',
  techStack: ['React 18', 'Node.js 20', 'PostgreSQL 15'],
  owner: 'Digital Experience Team',
  users: 50000,
  costPerYear: 250000,
  source: 'leanix'
})

CREATE (a2:Application {
  id: 'APP-456',
  name: 'Application Processing API',
  type: 'Backend Service',
  businessValue: 'High',
  technicalFit: 'Excellent',
  lifecycle: 'Active',
  techStack: ['Java 17', 'Spring Boot 3', 'PostgreSQL 15'],
  owner: 'Backend Services Team',
  transactions: 1000000,
  costPerYear: 180000,
  source: 'leanix'
})

CREATE (a3:Application {
  id: 'APP-789',
  name: 'Document Management Service',
  type: 'Microservice',
  businessValue: 'Medium',
  technicalFit: 'Good',
  lifecycle: 'Active',
  techStack: ['Python 3.11', 'FastAPI', 'AWS S3'],
  owner: 'Platform Team',
  documents: 5000000,
  costPerYear: 120000,
  source: 'leanix'
});

// Sample Data Objects
CREATE (d1:DataObject {
  id: 'DATA-789',
  name: 'CustomerTable',
  type: 'Database Table',
  database: 'customer_db',
  schema: 'public',
  sensitivity: 'PII',
  columns: ['id', 'name', 'email', 'phone', 'address', 'ssn_encrypted'],
  recordCount: 1500000,
  growthRate: '10% annually',
  source: 'leanix'
})

CREATE (d2:DataObject {
  id: 'DATA-012',
  name: 'ApplicationTable',
  type: 'Database Table',
  database: 'application_db',
  schema: 'public',
  sensitivity: 'Standard',
  columns: ['id', 'customer_id', 'status', 'submitted_date', 'type', 'amount'],
  recordCount: 3000000,
  growthRate: '15% annually',
  source: 'leanix'
})

CREATE (d3:DataObject {
  id: 'DATA-345',
  name: 'DocumentStorage',
  type: 'Object Storage',
  location: 'AWS S3',
  bucket: 'prod-documents',
  sensitivity: 'PII',
  retention: '7 years',
  sizeGB: 5000,
  encryption: 'AES-256',
  source: 'leanix'
});

// Sample Business Capabilities
CREATE (bc1:BusinessFunction {
  id: 'BC-001',
  name: 'Customer Authentication',
  level: 'L2',
  criticality: 'High',
  maturity: 'Optimized',
  description: 'Capability to authenticate and authorize customers',
  owner: 'Security Team',
  source: 'leanix'
})

CREATE (bc2:BusinessFunction {
  id: 'BC-002',
  name: 'Application Validation',
  level: 'L2',
  criticality: 'High',
  maturity: 'Managed',
  description: 'Capability to validate application data according to business rules',
  owner: 'Business Operations',
  source: 'leanix'
})

CREATE (bc3:BusinessFunction {
  id: 'BC-003',
  name: 'Document Management',
  level: 'L2',
  criticality: 'Medium',
  maturity: 'Managed',
  description: 'Capability to store, retrieve, and manage documents securely',
  owner: 'Platform Team',
  source: 'leanix'
});

// Sample Containers (C4 Model - will be migrated to API nodes)
CREATE (cont1:Container {
  id: 'CONT-001',
  name: 'React Frontend',
  type: 'Single-Page Application',
  technology: 'React 18',
  description: 'Customer-facing web application for application submission and tracking',
  responsibilities: ['User authentication', 'Application submission forms', 'Status tracking UI', 'Document upload interface'],
  communicationProtocol: 'HTTPS/REST',
  port: 3000,
  deployment: 'Containerized (Docker)',
  scaling: 'Horizontal',
  source: 'architecture'
})

CREATE (cont2:Container {
  id: 'CONT-002',
  name: 'API Gateway',
  type: 'API Gateway',
  technology: 'Node.js 20 / Express',
  description: 'Backend API gateway routing requests to microservices',
  responsibilities: ['Request routing', 'Authentication/Authorization', 'Rate limiting', 'API composition'],
  communicationProtocol: 'HTTPS/REST',
  port: 8080,
  deployment: 'Containerized (Docker)',
  scaling: 'Horizontal',
  source: 'architecture'
})

CREATE (cont3:Container {
  id: 'CONT-003',
  name: 'Application Service',
  type: 'Microservice',
  technology: 'Java 17 / Spring Boot 3',
  description: 'Core application processing microservice',
  responsibilities: ['Application validation', 'Business logic processing', 'Workflow orchestration', 'Status management'],
  communicationProtocol: 'HTTPS/REST',
  port: 8081,
  deployment: 'Containerized (Docker)',
  scaling: 'Horizontal',
  source: 'architecture'
})

CREATE (cont4:Container {
  id: 'CONT-004',
  name: 'Document Service',
  type: 'Microservice',
  technology: 'Python 3.11 / FastAPI',
  description: 'Document management and storage microservice',
  responsibilities: ['Document upload', 'Document retrieval', 'Format conversion', 'Encryption/Decryption'],
  communicationProtocol: 'HTTPS/REST',
  port: 8082,
  deployment: 'Containerized (Docker)',
  scaling: 'Horizontal',
  source: 'architecture'
})

CREATE (cont5:Container {
  id: 'CONT-005',
  name: 'PostgreSQL Database',
  type: 'Database',
  technology: 'PostgreSQL 15',
  description: 'Relational database for customer and application data',
  responsibilities: ['Data persistence', 'ACID transactions', 'Query processing', 'Data integrity'],
  communicationProtocol: 'PostgreSQL Wire Protocol',
  port: 5432,
  deployment: 'Managed Service (AWS RDS)',
  scaling: 'Vertical',
  source: 'architecture'
})

CREATE (cont6:Container {
  id: 'CONT-006',
  name: 'S3 Document Store',
  type: 'Object Storage',
  technology: 'AWS S3',
  description: 'Object storage for document files',
  responsibilities: ['Document storage', 'Versioning', 'Encryption at rest', 'Lifecycle management'],
  communicationProtocol: 'HTTPS/S3 API',
  deployment: 'Managed Service (AWS S3)',
  scaling: 'Auto-scaling',
  source: 'architecture'
});

// Sample Components (C4 Model - Components within Containers)
CREATE (comp1:Component {
  id: 'COMP-001',
  name: 'ApplicationController',
  type: 'REST Controller',
  container: 'CONT-003',
  technology: 'Spring MVC',
  description: 'Handles HTTP requests for application operations',
  responsibilities: ['Request validation', 'Response formatting', 'Error handling'],
  source: 'code'
})

CREATE (comp2:Component {
  id: 'COMP-002',
  name: 'ValidationService',
  type: 'Business Logic',
  container: 'CONT-003',
  technology: 'Spring Service',
  description: 'Validates application data according to business rules',
  responsibilities: ['Data validation', 'Business rule enforcement', 'Validation error reporting'],
  source: 'code'
})

CREATE (comp3:Component {
  id: 'COMP-003',
  name: 'WorkflowEngine',
  type: 'Business Logic',
  container: 'CONT-003',
  technology: 'Spring Service',
  description: 'Orchestrates application processing workflow',
  responsibilities: ['Workflow execution', 'State management', 'Process coordination'],
  source: 'code'
})

CREATE (comp4:Component {
  id: 'COMP-004',
  name: 'DataAccessLayer',
  type: 'Data Access',
  container: 'CONT-003',
  technology: 'Spring Data JPA',
  description: 'Handles database operations for application data',
  responsibilities: ['CRUD operations', 'Query execution', 'Transaction management'],
  source: 'code'
})

CREATE (comp5:Component {
  id: 'COMP-005',
  name: 'DocumentController',
  type: 'REST Controller',
  container: 'CONT-004',
  technology: 'FastAPI',
  description: 'Handles HTTP requests for document operations',
  responsibilities: ['File upload handling', 'Document retrieval', 'Format validation'],
  source: 'code'
})

CREATE (comp6:Component {
  id: 'COMP-006',
  name: 'EncryptionService',
  type: 'Security Service',
  container: 'CONT-004',
  technology: 'Python cryptography',
  description: 'Handles encryption and decryption of sensitive documents',
  responsibilities: ['Encryption', 'Decryption', 'Key management'],
  source: 'code'
})

CREATE (comp7:Component {
  id: 'COMP-007',
  name: 'StorageManager',
  type: 'Integration',
  container: 'CONT-004',
  technology: 'boto3',
  description: 'Manages interaction with S3 storage',
  responsibilities: ['S3 upload', 'S3 download', 'Metadata management'],
  source: 'code'
});

// Sample Server nodes
CREATE (srv1:Server {
  id: 'SRV-001',
  name: 'Web Server Cluster',
  type: 'Application Server',
  environment: 'production',
  provider: 'AWS',
  region: 'us-east-1',
  instanceType: 'c5.2xlarge',
  purpose: 'Frontend hosting',
  ipAddress: '10.0.1.50',
  status: 'Active',
  source: 'infrastructure'
})

CREATE (srv2:Server {
  id: 'SRV-003',
  name: 'API Server Cluster',
  type: 'Application Server',
  environment: 'production',
  provider: 'AWS',
  region: 'us-east-1',
  instanceType: 'c5.4xlarge',
  purpose: 'Backend services',
  ipAddress: '10.0.2.50',
  status: 'Active',
  source: 'infrastructure'
})

CREATE (srv3:Server {
  id: 'SRV-005',
  name: 'Database Server',
  type: 'Database Server',
  environment: 'production',
  provider: 'AWS RDS',
  region: 'us-east-1',
  instanceType: 'db.r5.4xlarge',
  purpose: 'PostgreSQL database',
  ipAddress: '10.0.3.50',
  status: 'Active',
  source: 'infrastructure'
});

// Sample AppChange nodes (Application Changes)
CREATE (ac1:AppChange {
  id: 'AC-001',
  name: 'Add multi-factor authentication',
  type: 'Enhancement',
  status: 'Planned',
  priority: 'High',
  changeType: 'add',
  description: 'Add MFA capability to enhance security',
  estimatedEffort: '3 weeks',
  plannedDate: date('2025-03-01'),
  source: 'change-management'
})

CREATE (ac2:AppChange {
  id: 'AC-002',
  name: 'Modify validation rules',
  type: 'Modification',
  status: 'In Progress',
  priority: 'Medium',
  changeType: 'modify',
  description: 'Update validation logic to support new application types',
  estimatedEffort: '1 week',
  plannedDate: date('2025-02-15'),
  source: 'change-management'
})

CREATE (ac3:AppChange {
  id: 'AC-003',
  name: 'Enable document versioning',
  type: 'Enhancement',
  status: 'Planned',
  priority: 'Medium',
  changeType: 'enable',
  description: 'Enable version control for uploaded documents',
  estimatedEffort: '2 weeks',
  plannedDate: date('2025-03-15'),
  source: 'change-management'
});

// Sample InfraChange nodes (Infrastructure Changes)
CREATE (ic1:InfraChange {
  id: 'IC-001',
  name: 'Upgrade database server',
  type: 'Upgrade',
  status: 'Planned',
  priority: 'High',
  changeType: 'modify',
  description: 'Upgrade PostgreSQL server to higher instance type for better performance',
  estimatedEffort: '1 week',
  plannedDate: date('2025-02-20'),
  downtime: '2 hours',
  source: 'infrastructure-management'
})

CREATE (ic2:InfraChange {
  id: 'IC-002',
  name: 'Add web server capacity',
  type: 'Scale',
  status: 'In Progress',
  priority: 'Medium',
  changeType: 'add',
  description: 'Add additional web server instances to handle increased traffic',
  estimatedEffort: '3 days',
  plannedDate: date('2025-02-10'),
  downtime: '0 hours',
  source: 'infrastructure-management'
})

CREATE (ic3:InfraChange {
  id: 'IC-003',
  name: 'Enable API server auto-scaling',
  type: 'Enhancement',
  status: 'Planned',
  priority: 'Medium',
  changeType: 'enable',
  description: 'Enable auto-scaling for API server cluster to handle load variations',
  estimatedEffort: '1 week',
  plannedDate: date('2025-03-01'),
  downtime: '0 hours',
  source: 'infrastructure-management'
});

// ============================================================================
// RELATIONSHIPS - Create connections between entities
// ============================================================================

// (Requirement relationships removed)

// Applications → Data Objects (high-level)
MATCH (a:Application {id: 'APP-123'}), (d:DataObject {id: 'DATA-789'})
CREATE (a)-[:USES {operations: ['READ', 'WRITE'], source: 'leanix'}]->(d);

MATCH (a:Application {id: 'APP-456'}), (d:DataObject {id: 'DATA-012'})
CREATE (a)-[:USES {operations: ['READ', 'WRITE'], source: 'leanix'}]->(d);

MATCH (a:Application {id: 'APP-789'}), (d:DataObject {id: 'DATA-345'})
CREATE (a)-[:USES {operations: ['READ', 'WRITE'], source: 'leanix'}]->(d);

// (Requirement → BusinessFunction relationships removed)

// AppChange → BusinessFunction, Component, DataObject (MODIFY with action property)
// AC-001: Add MFA capability
MATCH (ac:AppChange {id: 'AC-001'}), (bc:BusinessFunction {id: 'BC-001'})
CREATE (ac)-[:MODIFY {
  action: 'create',
  description: 'Adding multi-factor authentication enhances Customer Authentication capability',
  impact: 'High',
  source: 'change-management'
}]->(bc);

MATCH (ac:AppChange {id: 'AC-001'}), (comp:Component {id: 'COMP-002'})
CREATE (ac)-[:MODIFY {
  action: 'create',
  description: 'ValidationService will gain MFA validation logic',
  impact: 'High',
  source: 'change-management'
}]->(comp);

// AC-002: Modify validation rules
MATCH (ac:AppChange {id: 'AC-002'}), (bc:BusinessFunction {id: 'BC-002'})
CREATE (ac)-[:MODIFY {
  action: 'update',
  description: 'Updating validation rules to support new application types',
  impact: 'Medium',
  source: 'change-management'
}]->(bc);

MATCH (ac:AppChange {id: 'AC-002'}), (comp:Component {id: 'COMP-002'})
CREATE (ac)-[:MODIFY {
  action: 'update',
  description: 'ValidationService business rules will be modified',
  impact: 'Medium',
  source: 'change-management'
}]->(comp);

MATCH (ac:AppChange {id: 'AC-002'}), (d:DataObject {id: 'DATA-012'})
CREATE (ac)-[:MODIFY {
  action: 'update',
  description: 'ApplicationTable schema may need updates for new validation fields',
  impact: 'Low',
  source: 'change-management'
}]->(d);

// AC-003: Enable document versioning
MATCH (ac:AppChange {id: 'AC-003'}), (bc:BusinessFunction {id: 'BC-003'})
CREATE (ac)-[:MODIFY {
  action: 'enable',
  description: 'Enabling version control for Document Management capability',
  impact: 'Medium',
  source: 'change-management'
}]->(bc);

MATCH (ac:AppChange {id: 'AC-003'}), (comp:Component {id: 'COMP-007'})
CREATE (ac)-[:MODIFY {
  action: 'enable',
  description: 'StorageManager will enable versioning features',
  impact: 'Medium',
  source: 'change-management'
}]->(comp);

MATCH (ac:AppChange {id: 'AC-003'}), (d:DataObject {id: 'DATA-345'})
CREATE (ac)-[:MODIFY {
  action: 'enable',
  description: 'DocumentStorage will support version metadata',
  impact: 'Medium',
  source: 'change-management'
}]->(d);

// InfraChange → Server (only modify and add/enable)
// IC-001: Upgrade database server
MATCH (ic:InfraChange {id: 'IC-001'}), (s:Server {id: 'SRV-005'})
CREATE (ic)-[:MODIFY {
  action: 'update',
  description: 'Upgrading database server instance type for better performance',
  impact: 'High',
  downtime: '2 hours',
  source: 'infrastructure-management'
}]->(s);

// IC-002: Add web server capacity
MATCH (ic:InfraChange {id: 'IC-002'}), (s:Server {id: 'SRV-001'})
CREATE (ic)-[:MODIFY {
  action: 'create',
  description: 'Adding additional server instances to web server cluster',
  impact: 'Low',
  downtime: '0 hours',
  source: 'infrastructure-management'
}]->(s);

// IC-003: Enable API server auto-scaling
MATCH (ic:InfraChange {id: 'IC-003'}), (s:Server {id: 'SRV-003'})
CREATE (ic)-[:MODIFY {
  action: 'enable',
  description: 'Enabling auto-scaling capability for API server cluster',
  impact: 'Medium',
  downtime: '0 hours',
  source: 'infrastructure-management'
}]->(s);

// ============================================================================
// VERIFICATION QUERIES
// ============================================================================

// Count nodes by type
// (Requirement count removed)
MATCH (n:Application) RETURN 'Applications' as Type, count(n) as Count
UNION
MATCH (n:Component) RETURN 'Components' as Type, count(n) as Count
UNION
MATCH (n:DataObject) RETURN 'Data Objects' as Type, count(n) as Count
UNION
MATCH (n:Server) RETURN 'Servers' as Type, count(n) as Count
UNION
MATCH (n:BusinessFunction) RETURN 'Business Functions' as Type, count(n) as Count
UNION
MATCH (n:AppChange) RETURN 'Application Changes' as Type, count(n) as Count
UNION
MATCH (n:InfraChange) RETURN 'Infrastructure Changes' as Type, count(n) as Count;

// Count relationships by type
MATCH ()-[r:IMPLEMENTED_BY]->() RETURN 'IMPLEMENTED_BY' as Type, count(r) as Count
UNION
MATCH ()-[r:CONTAINS]->() RETURN 'CONTAINS' as Type, count(r) as Count
UNION
MATCH ()-[r:COMMUNICATES_WITH]->() RETURN 'COMMUNICATES_WITH' as Type, count(r) as Count
UNION
MATCH ()-[r:USES]->() RETURN 'USES' as Type, count(r) as Count
UNION
MATCH ()-[r:STORES]->() RETURN 'STORES' as Type, count(r) as Count
UNION
MATCH ()-[r:DEPLOYED_ON]->() RETURN 'DEPLOYED_ON' as Type, count(r) as Count
UNION
MATCH ()-[r:STORED_IN]->() RETURN 'STORED_IN' as Type, count(r) as Count
UNION
MATCH ()-[r:CALLS]->() RETURN 'CALLS' as Type, count(r) as Count
UNION
MATCH ()-[r:MODIFY]->() RETURN 'MODIFY' as Type, count(r) as Count
UNION
MATCH ()-[r:SUPPORTS]->() RETURN 'SUPPORTS' as Type, count(r) as Count;
